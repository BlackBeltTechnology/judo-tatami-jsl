model AutoMappedTransferObjectTypeModel;

type string String min-size:0 max-size:250;
type numeric Integer precision:3 scale:0;


entity EntityAncestor {
	field String name;
	field Integer attribute = 1;
	field EntityRelated containment;
	field EntityRelated[] containmentCollection;

	identifier Integer identifier;
	field Integer attributeDerived <= self.attribute;
	relation EntityRelated containmentDerived <= self.containment;
	relation EntityRelated[] containmentCollectionDerived <= self.containmentCollection;

	relation EntityRelated association;
	relation EntityRelated[] associationCollection;
}


entity Entity extends EntityAncestor {
	field Integer attribute2 = 2;
	field EntityRelated containment2;
	field EntityRelated[] containmentCollection2;

	field Integer attributeDerived2 <= self.attribute;
	relation EntityRelated containmentDerived2 <= self.containment;
	relation EntityRelated[] containmentCollectionDerived2 <= self.containmentCollection;

	relation EntityRelated association2;
	relation EntityRelated[] associationCollection2;
}

entity EntityRelated {
	field Integer attribute;

	@Query
    relation Entity singleCompositionEntityExpressionQuery(String name) <= entityWithNameQuery(name = name);

	@Query
    field Integer primitiveQuery(Integer i) <= queryInteger(i = i);

	relation Entity twoWayAssociation opposite-add: twoWayAssociationOpposite;
	relation Entity[] twoWayAssociationCollection opposite-add: twoWayAssociationCollectionOpposite;
}

query Entity entityWithNameQuery(String name) <= Entity!all()!filter(e | e.name == name)!any();
query Integer queryInteger(Integer i = 0) <= Entity!all()!filter(e | e.attribute2 > i)!size();

transfer AutoMapped maps Entity as entity;
transfer AutoMappedRelated maps EntityRelated as related;

